<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - ABACSTORE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>
</head>
<body>
    <script>
        // Firebase Config
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyD_OKecRD3bFiZBFikhNauAPZRdz-FKp9w",
  authDomain: "ecommerce-fbaa8.firebaseapp.com",
  projectId: "ecommerce-fbaa8",
  storageBucket: "ecommerce-fbaa8.firebasestorage.app",
  messagingSenderId: "296693502804",
  appId: "1:296693502804:web:d90e69e72e8983b753aec1",
  measurementId: "G-NJWZ20S9RM"
};

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check if user is logged in
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                loadUserData(user.uid);
            }
        });

        // Load User Data from Firestore
        function loadUserData(userId) {
            db.collection("users").doc(userId).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById("username").innerText = userData.fullName;
                    document.getElementById("email").innerText = userData.email;
                }
            });

            // Load Order History
            db.collection("orders").where("userId", "==", userId).get().then(snapshot => {
                let ordersHtml = "";
                snapshot.forEach(doc => {
                    let order = doc.data();
                    ordersHtml += `<li class="list-group-item">Order #${order.orderId} - ${order.status}</li>`;
                });
                document.getElementById("orderHistory").innerHTML = ordersHtml;
            });
        }

        // Logout Function
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        }
    </script>

    <div class="container mt-5">
        <h2>Welcome, <span id="username"></span></h2>
        <p>Email: <span id="email"></span></p>
        
        <h3>Order History</h3>
        <ul id="orderHistory" class="list-group"></ul>

        <button class="btn btn-danger mt-3" onclick="logout()">Logout</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
